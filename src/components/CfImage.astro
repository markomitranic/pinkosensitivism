---
import { Image } from "@unpic/astro";
import type { ImageMetadata } from "astro";

type Props = Parameters<typeof Image>[0];
// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
const { src, ...rest } = Astro.props;

// Always try to serve the image from its own domain, not ours.
let domain: string | undefined;
try {
  if (typeof src === "string") {
    domain = new URL(src).hostname;
  } else {
    domain = new URL((src as ImageMetadata).src).hostname;
  }
} catch {
  domain = undefined;
}
---

<Image
  src={src as string}
  cdn="cloudflare"
  options={{ cloudflare: { domain } }}
  {...rest}
/>
